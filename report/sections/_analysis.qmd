# Analysis

The analysis phase is dedicated to the development, refinement, and comprehensive evaluation of the predictive models, meticulously designed to directly address the previously defined research questions.

## Methods

The modeling process is structured to address the two key research questions:

1.  identifying the most significant lifestyle and behavioral factors contributing to obesity in Mexico, Peru, and Colombia;

2.  predicting whether a person will be obese based on some given combinations of factors.

### Linear Regression Model

A linear regression model will be developed to predict an individual’s BMI using weight and height as predictors, reflecting their foundational role in BMI calculation. As emphasized by Mendoza Palechor and De La Hoz Manotas (2019), these variables are fundamental to understanding body composition and are directly tied to the dataset's variable of obesity levels. By focusing on BMI as a continuous outcome, this approach complements categorical classifications by capturing more detailed variations in body composition across the population. The model will be evaluated using standard regression metrics, including Mean Squared Error (MSE), Root Mean Squared Error (RMSE), and R², ensuring its predictive accuracy and reliability while providing a robust foundation for public health applications.

### Logistic Regression Model

To accurately address the key research questions, a logistic regression model will be employed to estimate the probability of individuals belonging to a categorie: *obese* or *not obese*. Weight and height will be excluded as predictors in the model because they are directly used to calculate BMI, which serves as the basis for the obesity levels categorized in the dataset. Including these variables would create a dependency between the predictors and the target variable, potentially biasing the analysis. By excluding weight and height, the focus shifts to behavioral and lifestyle factors, such as dietary habits, physical activity, and demographic characteristics, to better understand their influence on obesity risk.

While logistic regression provides a clear and interpretable framework for estimating probabilities, it inherently limits the analysis to a binary classification. This restriction prevents the exploration of the full spectrum of obesity levels, such as Obesity Type I, II, or III, as classified in the dataset. Despite this limitation, logistic regression is a robust method for quantifying the relationships between independent variables and the binary outcome. Feature selection techniques will ensure that only the most relevant predictors are retained, and the model's performance will be rigorously evaluated using metrics such as accuracy, precision, recall, F1-score, and ROC-AUC, ensuring reliable and actionable insights.

### Insights and Limitations

Regression analysis helps us understand how predictors influence outcomes, with logistic regression classifying individuals as obese or not obese and linear regression predicting BMI as a continuous variable. The dataset offers a mix of advantages and challenges: synthetic data ensures balanced representation but lacks the complexity of real-world patterns, while user-collected data adds variability but is prone to biases. Logistic regression simplifies the analysis by focusing on binary outcomes, leaving out the nuanced gradations of obesity, and assumes linearity, which may not fully capture complex relationships. Linear regression relies on accurate weight and height data, making it sensitive to reporting errors. Despite these limitations, the models offer insights into obesity risk and body composition, serving as a valuable exercise and foundation for future projects, even if not directly applicable to real-world scenarios.

## Goals for Each Method

### **Linear Regression Model Development**

**Data Loading and Processing**

The dataset was imported, and initial exploration was conducted to understand its structure. BMI was calculated as a key variable, and missing values were addressed by removing incomplete rows. Boxplots were used to visualize the distributions of key variables, ensuring the dataset was ready for analysis.

```{r}
dataset_raw <- read.csv(here("data/raw/dataset_raw.csv"))
head(dataset_raw)
summary(dataset_raw)
dataset_raw$BMI <- dataset_raw$Weight / (dataset_raw$Height^2)
summary(dataset_raw$BMI)
if (sum(is.na(dataset_raw)) > 0) {cat("Missing values detected! Removing rows with NA.\n")
  dataset_raw <- na.omit(dataset_raw)}
boxplot(dataset_raw$Weight, main = "Weight Distribution", col = "grey", border = "black", notch = TRUE, horizontal = TRUE, xlab = "Weight (kg)", ylim = c(30, 200))
grid(nx = NULL, ny = NULL, lty = 0.5, col = "black")
boxplot(dataset_raw$Height, main = "Height Distribution", col = "lightgreen", border = "darkgreen", notch = TRUE, ylab = "Height (m)", ylim = c(1.4, 2))
```

**Model Development**

A linear regression model was built to examine the relationship between BMI, weight, and height. The model summary provided key performance metrics and insights into variable contributions.

```{r}
linear_model <- lm(BMI ~ Weight + Height, data = dataset_raw)
summary(linear_model)
```

**Evaluation**

The model was evaluated by generating predictions and calculating key performance metrics, including Mean Squared Error (MSE), Root Mean Squared Error (RMSE), and R-squared (R²). These metrics assess the model's accuracy and its ability to explain the variance in BMI.

```{r}
library(Metrics)
predictions <- predict(linear_model, newdata = dataset_raw)
head(predictions)
mse <- mean((dataset_raw$BMI - predictions)^2)
rmse <- rmse(dataset_raw$BMI, predictions)
r_squared <- summary(linear_model)$r.squared
cat("MSE:", mse, "\nRMSE:", rmse, "\nR²:", r_squared, "\n")
```

**Results Visualization**

A scatter plot was created to compare actual BMI values with predicted values. A reference line (ideal fit) was added to assess the alignment of predictions with true values. The plot provides a visual representation of the model's accuracy.

```{r}
plot(dataset_raw$BMI, predictions, xlab = "Actual BMI", ylab = "Predicted BMI", main = "Comparison between actual and predicted BMI", pch = 16, col = "blue", cex = 0.6) 
abline(0, 1, col = "red", lwd = 2)
legend("topleft", legend = c("Predicted Values", "Regression Line"), col = c("blue", "red"), pch = c(16, NA), lty = c(NA, 1), bty = "n")
```

**Diagnostics**

Diagnostic plots were generated to evaluate the linear regression model's assumptions, including residual patterns, normality, and variance consistency. A histogram of residuals was also created to assess their distribution, with a vertical reference line highlighting the zero-residual point.

```{r}
par(mfrow = c(2, 2), mar = c(4, 4, 2.5, 2), cex.main = 1.3, cex.lab = 1, cex.axis = 1)
plot(linear_model, col = "Blue",pch = 19, cex = 0.2, lwd = 2)

hist(residuals(linear_model), col = "Gray", border = "white", main = "Residuals Distribution", xlab = "Residuals", ylab = "Frequency", breaks = 15, cex.main = 1.2, cex.lab = 1.2, cex.axis = 1.2)
abline(v = 0, col = "red", lwd = 2, lty = 2)

```

### **Logistic Regression Model Development**

**Data Loading and Processing**

BMI was calculated and incorporated into the dataset to facilitate the classification of individuals by obesity status. A binary variable, Obesity, was then created to indicate whether an individual is classified as obese or not, based on their BMI. This variable was transformed into a factor to ensure proper integration into the logistic regression model. To confirm the accuracy and consistency of these transformations, the summary statistics and variable distributions were carefully inspected, ensuring the dataset was properly prepared for analysis.

```{r}
dataset_raw$BMI <- dataset_raw$Weight / (dataset_raw$Height^2)
head(dataset_raw$BMI)
summary(dataset_raw$BMI)
dataset_raw$Obesity <- ifelse(dataset_raw$BMI >= 30, 1, 0)
dataset_raw$Obesity <- as.factor(dataset_raw$Obesity)
table(dataset_raw$Obesity)
head(dataset_raw)
```

Twelve predictors associated with obesity-related behaviors, dietary habits, physical activity, and lifestyle factors were selected for analysis. These variables, along with the binary target variable Obesity (1 = obese, 0 = not obese), formed the dataset for logistic regression modeling. The dataset was reviewed to ensure correct structure and readiness for analysis.

```{r}
predictors <- c("family_history_with_overweight", "FAVC", "FCVC", "NCP", "CAEC", "SMOKE", "CH2O", "SCC", "FAF", "TUE", "CALC", "MTRANS")
model_data <- dataset_raw[, c("Obesity", predictors)]
str(model_data)
```

**Model Development**

To develop a predictive model for obesity, we employed logistic regression, a robust method for binary classification tasks.

```{r}
full_model <- glm(Obesity ~ ., data = model_data, family = binomial)
null_model <- glm(Obesity ~ 1, data = model_data, family = binomial)
stepwise_model <- step(null_model, scope = list(lower = null_model, upper = full_model), direction = "both", trace = FALSE)
```

summary modelli

```{r}
summary(full_model)
```

gg

```{r}
summary(null_model)
```

gg

```{r}
summary(stepwise_model)
```

Prevision and confusion matrix

```{r}
predicted_probs <- predict(stepwise_model, type = "response")
predicted_classes <- ifelse(predicted_probs >= 0.5, 1, 0)
conf_matrix <- confusionMatrix(as.factor(predicted_classes), model_data$Obesity)
print(conf_matrix)
```

visualization

```{r}
plot(predicted_probs, col = ifelse(model_data$Obesity == 1, "blue", "red"), pch = 16, xlab = "n° Observation", ylab = "Predicted Probability", main = "Predicted Probabilities of Obesity", cex = 0.6)
legend("bottomright", legend = c("Obese", "Not Obese"), col = c("blue", "red"), pch = 16)
```

## Results
